# feat-changelog-mem
将matrix-rain的数字雨动画整合到ted编辑器中。现在每次启动ted时，会先显示2秒的矩阵数字雨动画，然后进入编辑器界面。

  主要改动

  1. 文件整合

  - 复制 matrix-rain/src/digital_rain.c → src/digital_rain.c
  - 复制 matrix-rain/include/digital_rain.h → include/digital_rain.h
  - 删除不再需要的 src/digital_rain_main.c

  2. 代码修改

  src/digital_rain.c:
  - 移除 #define SP_IMPLEMENTATION（避免与ted主程序的SP实现冲突）
  - 新增 digital_rain_run_for_ms() 函数，支持指定时长运行动画

  include/digital_rain.h:
  - 添加 digital_rain_run_for_ms() 函数声明

  src/main.c:
  - 添加 #include "digital_rain.h"
  - 在编辑器初始化前插入2秒数字雨动画代码：
  digital_rain_t rain = digital_rain_create();
  rain.frame_delay_ms = 80;
  rain.alphabet_only = false;
  rain.use_colors = true;
  if (digital_rain_init(&rain)) {
      digital_rain_run_for_ms(&rain, 2000);
      digital_rain_destroy(&rain);
  }

  3. 构建系统更新

  Makefile:
  - 将 digital_rain.c 纳入ted编译（排除 digital_rain_main.c）
  - 移除独立的 digital_rain 构建目标
  - 更新 format 目标以包含新文件

  构建测试

  运行 make clean && make 编译成功，生成 bin/ted 可执行文件。

  行为说明

  1. 启动 ted 时，先显示2秒矩阵数字雨动画
  2. 动画期间可按任意键提前退出
  3. 动画结束后自动进入编辑器界面
  4. 终端设置会正确恢复，不影响编辑器功能

  待处理项

  - matrix-rain/ 目录可以保留或删除（代码已整合）
  - 动画失败时（如终端大小不支持）会静默跳过，不影响编辑器启动

  你可以运行 ./bin/ted 测试效果。动画结束后按 Ctrl+Q 退出编辑器。

  已实现的Ctrl命令（Insert模式）

  ┌────────┬────────────┬───────────┬──────────────────────────────┐
  │ 快捷键 │    功能    │   状态    │             备注             │
  ├────────┼────────────┼───────────┼──────────────────────────────┤
  │ Ctrl+Q │ 退出编辑器 │ ✅ 已修复 │ 原需要按两次，现改为一次退出 │
  ├────────┼────────────┼───────────┼──────────────────────────────┤
  │ Ctrl+S │ 保存文件   │ ✅ 正常   │ case 19                      │
  ├────────┼────────────┼───────────┼──────────────────────────────┤
  │ Ctrl+F │ 搜索       │ ✅ 正常   │ case 6                       │
  ├────────┼────────────┼───────────┼──────────────────────────────┤
  │ Ctrl+G │ 跳转到行   │ ✅ 正常   │ case 7                       │
  ├────────┼────────────┼───────────┼──────────────────────────────┤
  │ Ctrl+Z │ 撤销       │ ✅ 正常   │ case 26                      │
  ├────────┼────────────┼───────────┼──────────────────────────────┤
  │ Ctrl+Y │ 重做       │ ✅ 正常   │ case 25                      │
  ├────────┼────────────┼───────────┼──────────────────────────────┤
  │ Ctrl+D │ 删除行     │ ✅ 正常   │ case 4                       │
  ├────────┼────────────┼───────────┼──────────────────────────────┤
  │ Ctrl+L │ 重绘屏幕   │ ✅ 正常   │ case 12                      │
  └────────┴────────────┴───────────┴──────────────────────────────┘

  Normal模式退出键

  ┌──────┬──────┬─────────┬──────────────┐
  │ 按键 │ 功能 │  状态   │     备注     │
  ├──────┼──────┼─────────┼──────────────┤
  │ q    │ 退出 │ ✅ 正常 │ 原已实现     │
  ├──────┼──────┼─────────┼──────────────┤
  │ Q    │ 退出 │ ✅ 新增 │ 新增大写支持 │
  └──────┴──────┴─────────┴──────────────┘

  未实现的Ctrl命令（main.c中提及但未实现）

  - Ctrl+C (复制) - 仅文档提及
  - Ctrl+X (剪切) - 仅文档提及
  - Ctrl+V (粘贴) - 仅文档提及
  这些是计划功能，当前代码未实现。

  ✅ 复制粘贴功能实现完成

实现的部分文本复制粘贴功能

  新增功能

  1. 选区支持 - 使用 Shift+方向键（↑↓←→）选择文本
  2. 部分文本复制 (Ctrl+C) - 有选区时复制选区内容，否则复制整行
  3. 部分文本剪切 (Ctrl+X) - 有选区时剪切选区内容，否则剪切整行
  4. 智能粘贴 (Ctrl+V):
    - 有选区时先删除选区再粘贴
    - 单行文本在光标位置插入
    - 多行文本（含换行）正确分割插入

  技术实现

  - editor_get_selection() - 获取选区文本（支持跨行）
  - editor_delete_selection() - 删除选区并返回删除的文本
  - 粘贴时检测剪贴板内容是否含换行符，智能处理单行/多行粘贴
  - 所有编辑操作（输入、删除、换行）在有选区时会先删除选区

  现在编辑器支持标准的部分文本复制粘贴

  1. shift + 方向键 拖选：在触控板上点击并向右滑动，文本应反白显示
  2. 复制粘贴：选中后按 Ctrl+C 复制，Ctrl+V 粘贴
  3. 跨行选择：垂直拖动可跨行选择
  4. 水平滚动：在有水平滚动的文件中测试选中准确性